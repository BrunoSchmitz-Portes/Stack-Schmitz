<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8">
  <title>Como verificar o uso da TEMP no Oracle</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet"
        href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
  <style>
    body {
      font-family: Arial, sans-serif;
      line-height: 1.7;
      background-color: #f4f4f4;
      color: #333;
      padding: 20px;
      max-width: 900px;
      margin: auto;
    }
    h1, h2 {
      color: #2c3e50;
    }
    code {
      background: #eee;
      padding: 2px 6px;
      border-radius: 4px;
      font-family: monospace;
    }
    .step {
      margin-bottom: 30px;
    }
    .important {
      background: #fff3cd;
      padding: 10px;
      border-left: 6px solid #ffc107;
      margin-top: 15px;
      border-radius: 4px;
    }
    .icon {
      margin-right: 6px;
      color: #2980b9;
    }
    .note {
      background: #d1ecf1;
      padding: 10px;
      border-left: 6px solid #0c5460;
      border-radius: 4px;
      margin: 15px 0;
    }
    .highlight {
      background-color: #e2ffe2;
      border-left: 6px solid #28a745;
      padding: 10px;
      border-radius: 4px;
      margin: 15px 0;
    }
    img {
      max-width: 100%;
      border: 1px solid #ccc;
      border-radius: 4px;
      margin: 20px 0;
    }
    footer {
      text-align: center;
      margin-top: 50px;
      color: #777;
    }
  </style>
</head>
<body>

  <h1><i class="fas fa-database icon"></i> Verificando o consumo da TEMP no Oracle</h1>
  <p><strong>Atualizado:</strong> Setembro/2025</p>

  <div class="step">
    <h2>üìå Introdu√ß√£o</h2>
    <p>A <strong>tablespace TEMP</strong> no Oracle √© usada para opera√ß√µes intermedi√°rias que n√£o podem ser realizadas inteiramente em mem√≥ria, como ordena√ß√µes, joins e cria√ß√£o de √≠ndices. Quando a TEMP se esgota, isso pode gerar erros do tipo <code>ORA-01652</code>, impactando diretamente as aplica√ß√µes.</p>
    <p>Por isso, √© essencial monitorar o uso dessa tablespace para evitar gargalos de performance e falhas em sess√µes.</p>
  </div>

  <div class="step">
    <h2>üìä 1. Verificando espa√ßo utilizado na TEMP</h2>
    <p>Use a query abaixo para consultar o espa√ßo total, utilizado, livre e o percentual livre da sua TEMP:</p>
    
    <div class="highlight">
<code>SELECT tarea.tablespace_name,<br>
       tarea.tsize,<br>
       tcorrente,<br>
       ROUND(tarea.tsize - tcorrente + SUM(NVL(free.bytes, 0))/1024/1024, 0) AS livre,<br>
       ROUND(((tarea.tsize - tcorrente + SUM(NVL(free.bytes, 0))/1024/1024)*100)/tarea.tsize, 0) AS "% Livre"<br>
FROM dba_free_space free,<br>
     (SELECT tablespace_name,<br>
             SUM(a.bytes)/1024/1024 tcorrente,<br>
             SUM(DECODE(NVL(a.maxbytes,0),0,a.bytes,a.maxbytes))/1024/1024 tsize<br>
      FROM dba_temp_files a<br>
      GROUP BY tablespace_name) tarea<br>
WHERE free.tablespace_name(+) = tarea.tablespace_name<br>
GROUP BY tarea.tablespace_name, tarea.tsize, tcorrente<br>
ORDER BY 5 DESC;</code>
    </div>

    <img src="img/info_temp.png" alt="Consulta de espa√ßo utilizado na TEMP">

    <div class="note">
      <strong>Entenda os campos da consulta:</strong><br><br>
      <strong>TABLESPACE_NAME</strong>: √© o nome da sua TEMP, anote para a pr√≥xima consulta.<br>
      <strong>TSIZE</strong>: √© o tamanho total da tablespace, ou seja, o espa√ßo m√°ximo alocado.<br>
      <strong>TCORRENTE</strong>: espa√ßo usado no momento.<br>
      <strong>LIVRE</strong>: espa√ßo livre, em GB.<br>
      <strong>% LIVRE</strong>: representa o espa√ßo livre em porcentagem para facilitar a visualiza√ß√£o.
    </div>
  </div>

  <div class="step">
    <h2>üîç 2. Identificando sess√µes que consomem TEMP</h2>
    <p>Agora que voc√™ j√° sabe o quanto est√° sendo usado da TEMP, √© hora de identificar quem est√° consumindo. Use a query abaixo:</p>

    <div class="highlight">
<code>SELECT  su.username,<br>
        ses.sid,<br>
        ses.serial#,<br>
        su.tablespace,<br>
        CEIL((su.blocks * dt.block_size) / 1048576) AS MB<br>
FROM    gv$sort_usage su,<br>
        dba_tablespaces dt,<br>
        gv$session ses<br>
WHERE   su.tablespace = dt.tablespace_name<br>
AND     su.session_addr = ses.saddr<br>
AND     dt.tablespace_name = 'TEMP'<br>
ORDER BY ses.inst_id;</code>
    </div>

    <img src="img/consome-temp.png" alt="Consulta de sess√µes que consomem TEMP">

    <div class="note">
      <strong>Campos da consulta:</strong><br><br>
      <strong>USERNAME</strong>: usu√°rio de banco que est√° executando opera√ß√µes.<br>
      <strong>SID</strong>: ID da sess√£o ativa.<br>
      <strong>SERIAL#</strong>: n√∫mero serial da sess√£o (usado junto do SID para kill, por exemplo).<br>
      <strong>TABLESPACE</strong>: nome da tablespace TEMP que est√° sendo utilizada.<br>
      <strong>MB</strong>: quantidade de espa√ßo (em MB) que est√° sendo usada pela sess√£o.
    </div>
  </div>

  <footer>
    <p>Documenta√ß√£o criada por Bruno Schmitz ‚Äì Stack-Schmitz ¬© 2025</p>
  </footer>

</body>
</html>
